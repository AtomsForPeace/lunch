<html>
	<head>
		<title>Mittagsoptionen</title>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<style>
			#container {
				width: 50%;
			}
			.left {
				float: left;
				width: 50%;
			}
			.right {
				float: right;
				width: 50%;
			}
			.row {
				padding: 3px;
				border-left: 1px solid orange;
				border-bottom: 1px solid orange;
			}
			.restaurant {
				cursor: pointer;
			}
		</style>
	</head>
	<body>
		<div class="container-fluid" id=container>
			<div class="name left"></div>
			<div class="vote right"></div>
		</div>
	</body>
	<script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
	<script type="text/javascript">
		var add_restaurant = function(restaurant) {
			name = restaurant[0]
			vote = restaurant[1]
			$('.left').append(
				'<div class="restaurant row border-0" id=' + name + '>' + name + '</div>'
			)
			$('.right').append(
					'<div class="row border-0">' + vote + '</div>'
			)
		}
		var ws = new WebSocket(
			'ws://' + document.domain + ':' + location.port + '/update')
		$.ajax({
			url: '/restaurants',
			success: function(data) {
				data = $.parseJSON(data);
				data['message'].map(r => add_restaurant(r))
				$('.restaurant').each(function(index) {
					$(this).click(function() {
						ws.send($(this).text());
					})
				})
			},
			error: function() {
				console.log('ERROR!')
			}
		});
		ws.onmessage = function (event) {
			if (event.data == '406') {
				alert('Du darfst nur einmal pro Option waehlen!')
				return
			}
			data = event.data;
			rest = $('#' + data)
			index = $('.name').children().index(rest)
			old_value = parseInt($('.vote').children()[index].textContent)
			$('.vote').children()[index].textContent = old_value + 1
		}
	</script>
</html>
